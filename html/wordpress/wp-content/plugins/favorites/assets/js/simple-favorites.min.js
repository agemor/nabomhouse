function favorites_after_button_submit(){}function favorites_after_initial_load(){}jQuery(document).ready(function(){new Favorites});var Favorites=function(){var t=this,a=jQuery;return t.formactions={nonce:"simplefavorites_nonce",favoritesarray:"simplefavorites_array",favorite:"simplefavorites_favorite",clearall:"simplefavorites_clear",favoritelist:"simplefavorites_list"},t.buttons=".simplefavorite-button",t.lists=".favorites-list",t.clear_buttons=".simplefavorites-clear",t.total_favorites=".simplefavorites-user-count",t.ajaxurl=simple_favorites.ajaxurl,t.favorite=simple_favorites.favorite,t.favorited=simple_favorites.favorited,t.include_count=simple_favorites.includecount,t.indicate_loading=simple_favorites.indicate_loading,t.loading_text=simple_favorites.loading_text,t.loading_image_active=simple_favorites.loading_image_active,t.loading_image=simple_favorites.loading_image,t.nonce="",t.userfavorites,t.bindEvents=function(){a(document).on("click",t.buttons,function(e){e.preventDefault(),t.submitFavorite(a(this))}),a(document).on("click",t.clear_buttons,function(e){e.preventDefault(),t.clearFavorites(a(this))})},t.init=function(){t.bindEvents(),t.generateNonce()},t.generateNonce=function(){a.ajax({url:t.ajaxurl,type:"post",datatype:"json",data:{action:t.formactions.nonce},success:function(a){t.nonce=a.nonce,t.setUserFavorites(t.updateAllButtons)}})},t.setUserFavorites=function(e){a.ajax({url:t.ajaxurl,type:"post",datatype:"json",data:{action:t.formactions.favoritesarray},success:function(a){t.userfavorites=a.favorites,t.updateAllLists(),t.updateAllButtons(),t.updateClearButtons(),t.updateTotalFavorites(),e&&e(),favorites_after_initial_load(t.userfavorites)}})},t.updateAllButtons=function(e){for(var i=0;i<a(t.buttons).length;i++){var o=a(t.buttons)[i],s=a(o).attr("data-postid"),r=a(o).attr("data-siteid"),n=a(o).attr("data-favoritecount"),d="",l=t.siteIndex(r),u=t.userfavorites[l].posts;t.isFavorite(s,u)?(n=t.userfavorites[l].posts[s].total,d=t.addFavoriteCount(t.favorited,n),a(o).addClass("active").html(d).removeClass("loading")):(d=t.addFavoriteCount(t.favorite,n),a(o).removeClass("active").html(d).removeClass("loading"))}e&&e()},t.siteIndex=function(a){for(var e=0;e<t.userfavorites.length;e++)if(t.userfavorites[e].site_id===parseInt(a))return e},t.addFavoriteCount=function(a,e){return"1"===t.include_count&&(a+=' <span class="simplefavorite-button-count">'+e+"</span>"),a},t.submitFavorite=function(e){a(e).attr("disabled","disabled"),a(e).addClass("loading");var i=a(e).attr("data-postid"),o=a(e).attr("data-siteid"),s=parseInt(a(e).attr("data-favoritecount")),r="inactive",n="",d="";a(e).hasClass("active")?(a(e).removeClass("active"),0>s-1&&(s=1),a(e).attr("data-favoritecount",s-1),d=t.addFavoriteCount(t.favorite,s-1)):(r="active",a(e).addClass("active"),a(e).attr("data-favoritecount",s+1),d=t.addFavoriteCount(t.favorited,s+1)),n=t.addButtonLoading(d,r),a(e).html(n),a.ajax({url:t.ajaxurl,type:"post",datatype:"json",data:{action:t.formactions.favorite,nonce:t.nonce,postid:i,siteid:o,status:r},success:function(i){a(e).removeClass("loading"),a(e).html(d),a(e).attr("disabled",!1),t.userfavorites=i.favorites,t.updateAllLists(),t.updateAllButtons(),t.updateClearButtons(),t.updateTotalFavorites(),favorites_after_button_submit(i.favorites)}})},t.addButtonLoading=function(a,e){return"1"!==t.indicate_loading?a:"active"===e?t.loading_text+t.loading_image_active:t.loading_text+t.loading_image},t.updateClearButtons=function(){for(var e=0;e<a(t.clear_buttons).length;e++)for(var i=a(t.clear_buttons)[e],o=a(i).attr("data-siteid"),s=0;s<t.userfavorites.length;s++)t.userfavorites[s].site_id===parseInt(o)&&(t.objectLength(t.userfavorites[s].posts)>0?a(i).attr("disabled",!1):a(i).attr("disabled","disabled"))},t.clearFavorites=function(e){a(e).addClass("loading"),a(e).attr("disabled","disabled");var i=a(e).attr("data-siteid");a.ajax({url:t.ajaxurl,type:"post",datatype:"json",data:{action:t.formactions.clearall,nonce:t.nonce,siteid:i},success:function(i){t.userfavorites=i.favorites,a(e).removeClass("loading"),t.resetCounts()}})},t.resetCounts=function(){for(var e=a(".simplefavorite-button.active.has-count"),i=0;i<e.length;i++){var o=a(e)[i],s=a(o).find(".simplefavorite-button-count"),r=a(s).text()-1;a(o).attr("data-favoritecount",r)}t.setUserFavorites(t.updateAllButtons)},t.updateAllLists=function(){for(var e=0;e<t.userfavorites.length;e++)for(var i=a(t.lists+'[data-siteid="'+t.userfavorites[e].site_id+'"]'),o=0;o<a(i).length;o++)if(""===a(i[o]).attr("data-userid")){var s=a(i)[o];t.updateSingleList(a(s),t.userfavorites[e].posts)}else t.updateUserList(i[o])},t.updateSingleList=function(e,i){t.removeInvalidListItems(e,i);var o="true"===a(e).attr("data-includebuttons")?!0:!1,s="true"===a(e).attr("data-includelinks")?!0:!1,r=a(e).find("li");a.each(r,function(){var t=a(this).attr("data-postid");("undefined"==typeof t||t===!1)&&a(this).remove()}),t.objectLength(i)>0?a(e).find("[data-nofavorites]").remove():(html="<li data-nofavorites>"+a(e).attr("data-nofavoritestext")+"</li>",a(e).empty().append(html));var n=a(e).attr("data-posttype");n=n.split(","),a.each(i,function(t,i){n.length>0&&-1===a.inArray(i.post_type,n)||a(e).find("li[data-postid="+i.post_id+"]").length>0||(html='<li data-postid="'+i.post_id+'">',o&&(html+="<p>"),s&&(html+='<a href="'+i.permalink+'">'),html+=i.title,s&&(html+="</a>"),o&&(html+="</p><p>"+i.button+"</p>"),html+="</li>",a(e).append(html))})},t.updateUserList=function(e){var i=a(e).attr("data-userid"),o=a(e).attr("data-siteid"),s=a(e).attr("data-includelinks"),r=a(e).attr("data-includebuttons"),n=a(e).attr("data-posttype");console.log(n),a.ajax({url:t.ajaxurl,type:"post",datatype:"json",data:{action:t.formactions.favoritelist,nonce:t.nonce,userid:i,siteid:o,includelinks:s,includebuttons:r,posttype:n},success:function(t){a(e).replaceWith(t.list)}})},t.removeInvalidListItems=function(e,i){var o=a(e).find("li[data-postid]");a.each(o,function(){var e=a(this).attr("data-postid");t.isFavorite(e,i)||a(this).remove()})},t.updateTotalFavorites=function(){for(var e=0;e<a(t.total_favorites).length;e++){for(var i=a(t.total_favorites)[e],o=parseInt(a(i).attr("data-siteid")),s=a(i).attr("data-posttypes"),r=s.split(","),n=0,d=0;d<t.userfavorites.length;d++){var l=t.userfavorites[d];l.site_id===o&&a.each(l.posts,function(){return"all"===a(i).attr("data-posttypes")?void n++:void(-1!==a.inArray(this.post_type,r)&&n++)})}a(i).text(n)}},t.isFavorite=function(t,e){var i=!1;return a.each(e,function(a,e){e.post_id===parseInt(t)&&(i=!0),parseInt(e.post_id)===t&&(i=!0)}),i},t.objectLength=function(t){var a,e=0;for(a in t)t.hasOwnProperty(a)&&e++;return e},t.init()};